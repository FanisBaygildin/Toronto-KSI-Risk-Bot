# -*- coding: utf-8 -*-
"""telegram_bot0.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1zdI3nw8NLCmHfjUAFPvFU_5ukcgaEvkv
"""

import os, asyncio
from telegram import Update
from telegram.ext import (ApplicationBuilder,
                         ContextTypes,
                         CommandHandler,
                         MessageHandler,
                         ConversationHandler,
                         filters
                         )

START_PC = 0      # –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

    '''
    await: –ü–æ—Å–∫–æ–ª—å–∫—É –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (async def), –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è - —ç—Ç–æ –∫–æ—Ä–æ—É—Ç–∏–Ω–∞. await ¬´–¥–æ–∂–∏–¥–∞–µ—Ç—Å—è¬ª –µ—ë –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è –≤–µ—Å—å –±–æ—Ç.
    update: –û–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ python-telegram-bot –ø–µ—Ä–µ–¥–∞—ë—Ç –≤–∞—à–µ–º—É —Ö–µ–Ω–¥–ª–µ—Ä—É (—Ö–µ–Ω–¥–ª–µ—Ä - —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è start –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ). –í –Ω—ë–º –ª–µ–∂–∏—Ç –≤—Å—ë, —á—Ç–æ –ø—Ä–∏—à–ª–æ –æ—Ç Telegram: —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –¥–∞–Ω–Ω—ã–µ –æ —á–∞—Ç–µ, –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ —Ç.–¥.
    .message: –ê—Ç—Ä–∏–±—É—Ç update, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –æ–±—ä–µ–∫—Ç Message ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    .reply_text(...): –ú–µ—Ç–æ–¥ Message, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ —Ç–æ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Å—Ç–∞–≤–∏—Ç ¬´reply-to¬ª).
                  –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–µ –Ω–∞ —á—Ç–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–º–∞–Ω–¥–∞ /start –≤ –ª–∏—á–Ω–æ–º —á–∞—Ç–µ), –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏—à–ª—ë—Ç –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
    "üìç Send postal code of the start point": –¢–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –±–æ—Ç –ø–æ—à–ª—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –≠–º–æ–¥–∑–∏ ¬´üìç¬ª –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–µ—Ç, —á—Ç–æ —Ä–µ—á—å –æ –ª–æ–∫–∞—Ü–∏–∏.
    '''
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:    # update - —Ç–æ, —á—Ç–æ –ø—Ä–∏—Å–ª–∞–ª —é–∑–µ—Ä, context ‚Äî ¬´—á–µ–º –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è¬ª –∏ ¬´–≥–¥–µ —Å–ª–æ–∂–∏—Ç—å –¥–∞–Ω–Ω—ã–µ¬ª, —á—Ç–æ–±—ã –ø–æ–º–Ω–∏—Ç—å –∏—Ö –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–∞—Ö.
    await update.message.reply_text("üìç Send postal code of the start point")
    return START_PC

async def receive_start_pc(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    # –ø–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –ø–µ—á–∞—Ç–∞–µ–º –≤ –∫–æ–Ω—Å–æ–ª—å, –ø–æ—Ç–æ–º —Å–æ—Ö—Ä–∞–Ω–∏–º –∏ –ø–æ–π–¥—ë–º –¥–∞–ª—å—à–µ
    print("Start PC:", update.message.text)
    await update.message.reply_text("‚úÖ Got it (–¥–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏ ‚Äî –ø–æ–∑–∂–µ)")
    return ConversationHandler.END

async def main():
    app = (
        ApplicationBuilder()
        .token(os.getenv("BOT_TOKEN"))   # BOT_TOKEN –∑–∞–¥–∞—à—å –≤ Render
        .build()
    )
    conv = ConversationHandler(
        entry_points=[CommandHandler("start", start)],
        states={START_PC: [MessageHandler(filters.TEXT & ~filters.COMMAND, receive_start_pc)]},
        fallbacks=[],
    )
    app.add_handler(conv)
    await app.run_polling()

if __name__ == "__main__":
    asyncio.run(main())